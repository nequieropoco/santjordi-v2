generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Department {
  id    String @id @default(uuid())
  title Json
  order Int    @default(0)

  items Item[]
}

model Item {
  id           String  @id @default(uuid())
  departmentId String
  title        Json
  price        Decimal @db.Decimal(10, 2)
  order        Int     @default(0)

  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  allergens ItemAllergen[]

  @@index([departmentId])
}

model Allergen {
  id    String @id @default(uuid())
  code  String @unique
  label Json

  items           ItemAllergen[]
  supplementItems SupplementItemAllergen[]
}

model ItemAllergen {
  itemId     String
  allergenId String

  item     Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  allergen Allergen @relation(fields: [allergenId], references: [id], onDelete: Cascade)

  @@id([itemId, allergenId])
  @@index([allergenId])
}

model SupplementGroup {
  id    String @id @default(uuid())
  title Json
  order Int    @default(0)

  items SupplementItem[]
}

model SupplementItem {
  id      String  @id @default(uuid())
  groupId String
  title   Json
  price   Decimal @db.Decimal(10, 2)
  order   Int     @default(0)

  group SupplementGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  allergens SupplementItemAllergen[]

  @@index([groupId])
}

model SupplementItemAllergen {
  supplementItemId String
  allergenId       String

  supplementItem SupplementItem @relation(fields: [supplementItemId], references: [id], onDelete: Cascade)
  allergen       Allergen       @relation(fields: [allergenId], references: [id], onDelete: Cascade)

  @@id([supplementItemId, allergenId])
  @@index([allergenId])
}
