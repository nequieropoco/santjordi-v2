generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


model Department {
  id       String @id @default(cuid())
  titleCa  String
  titleEs  String
  order    Int

  items    Item[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Item {
  id           String @id @default(cuid())
  departmentId String
  titleCa      String
  titleEs      String
  price        Decimal @db.Decimal(10, 2)
  order        Int

  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  allergens  ItemAllergen[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SupplementGroup {
  id      String @id @default(cuid())
  titleCa String
  titleEs String
  order   Int

  items   SupplementItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SupplementItem {
  id      String @id @default(cuid())
  groupId String
  titleCa String
  titleEs String
  price   Decimal @db.Decimal(10, 2)
  order   Int

  group      SupplementGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  allergens  SupplementItemAllergen[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Allergen {
  id      String @id @default(cuid())
  code    String @unique
  labelCa String
  labelEs String

  items          ItemAllergen[]
  supplementItems SupplementItemAllergen[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ItemAllergen {
  itemId     String
  allergenId String

  item     Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  allergen Allergen @relation(fields: [allergenId], references: [id], onDelete: Cascade)

  @@id([itemId, allergenId])
}

model SupplementItemAllergen {
  supplementItemId String
  allergenId       String

  supplementItem SupplementItem @relation(fields: [supplementItemId], references: [id], onDelete: Cascade)
  allergen       Allergen       @relation(fields: [allergenId], references: [id], onDelete: Cascade)

  @@id([supplementItemId, allergenId])
}

enum SuggestionSection {
  FOOD
  DESSERT
  OTHER
}

model SuggestionSheet {
  id        String   @id @default(cuid())
  dateFrom  DateTime
  dateTo    DateTime
  isActive  Boolean  @default(true)

  items     SuggestionItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SuggestionItem {
  id        String @id @default(cuid())
  sheetId   String
  sheet     SuggestionSheet @relation(fields: [sheetId], references: [id], onDelete: Cascade)

  section   SuggestionSection
  titleCa   String
  titleEs   String
  price     Decimal @db.Decimal(10,2)
  order     Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sheetId, section, order])
}
